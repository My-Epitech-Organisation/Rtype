Network Working Group                                R-Type Project Team
Request for Comments: 0001                                     EPITECH
Category: Experimental                                   December 2025


                     R-Type Game Protocol (RTGP)
              Version 1.3.0 (Game Events & Power-Up System)

Abstract

   This document specifies the binary application-layer protocol used
   for real-time communication between the R-Type Client and Server.
   It defines a lightweight datagram-oriented protocol prioritizing low
   latency and bandwidth efficiency, specifies a selective reliability
   layer (RUDP) over UDP to ensure critical game events are delivered,
   and introduces game-over notifications, power-up event synchronization,
   and latency measurement capabilities.

Status of This Memo

   This document is a project specification intended for implementation
   and review.  It is not an IETF RFC and does not constitute an
   Internet Standards Track specification.

Copyright Notice

   Copyright (c) 2025 R-Type Project Team.  All rights reserved.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Terminology & Conventions . . . . . . . . . . . . . . . . . .   2
   3.  Transport Layer . . . . . . . . . . . . . . . . . . . . . . .   3
   4.  Packet Structure  . . . . . . . . . . . . . . . . . . . . . .   3
     4.1.  Header Format . . . . . . . . . . . . . . . . . . . . . .   3
     4.2.  User ID Conventions . . . . . . . . . . . . . . . . . . .   4
     4.3.  Reliability Mechanism (Flags) . . . . . . . . . . . . . .   4
   5.  Protocol Operations (OpCodes) . . . . . . . . . . . . . . . .   5
     5.1.  Session Management  . . . . . . . . . . . . . . . . . . .   5
     5.2.  Gameplay & Entity Management  . . . . . . . . . . . . . .   6
     5.3.  Input & Reconciliation  . . . . . . . . . . . . . . . . .   7
     5.4.  System & Diagnostics  . . . . . . . . . . . . . . . . . .   7
   6.  Security Considerations . . . . . . . . . . . . . . . . . . .   7
   7.  Payload Size Reference  . . . . . . . . . . . . . . . . . . .   8
   8.  Changes from Previous Versions  . . . . . . . . . . . . . . .   8
   9.  Future Extensions . . . . . . . . . . . . . . . . . . . . . .   9

1.  Introduction

   The R-Type Game Protocol (RTGP) is a lightweight, binary,
   datagram-oriented protocol designed to facilitate real-time
   multiplayer gameplay.  It prioritizes low latency and bandwidth
   efficiency while providing a selective reliability mechanism (RUDP)
   to ensure critical game events are delivered without the overhead
   of TCP.

2.  Terminology & Conventions

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in RFC 2119.

2.1.  Data Types

   o  Byte: 8-bit unsigned integer
   o  uint16: 16-bit unsigned integer
   o  uint32: 32-bit unsigned integer
   o  int32: 32-bit signed integer
   o  float: 32-bit IEEE 754 floating point
   o  String: NOT SUPPORTED in standard packets to avoid allocation
      overhead, unless specified in the payload

2.2.  Byte Order

   All multi-byte numeric fields MUST be transmitted in Network Byte
   Order (Big-Endian).  Implementations on Little-Endian architectures
   (x86/x64) MUST convert data before transmission (htons, htonl) and
   after reception (ntohs, ntohl).

3.  Transport Layer

   o  Protocol: UDP (User Datagram Protocol)
   o  Default Port: 4242
   o  MTU Safety: The total packet size (Header + Payload) SHOULD NOT
      exceed 1400 bytes to avoid IP fragmentation on standard networks

4.  Packet Structure

   Every RTGP packet consists of a fixed 16-byte Header followed by a
   variable-length Data Payload.

4.1.  Header Format

     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  Magic Byte   |  Packet Type  |          Packet Size          |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                            User ID                            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |          Sequence ID          |            Ack ID             |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |     Flags     |                   Reserved                    |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Field Definitions:

   o  Magic Byte (uint8): MUST be 0xA1.  Used to filter spurious
      traffic.
   o  Packet Type (uint8): The Operation Code (OpCode) defined in
      Section 5.
   o  Packet Size (uint16): Length of the Data Payload in bytes.
      Excludes Header size.
   o  User ID (uint32): The sender's unique identifier.
   o  Sequence ID (uint16): Incremental ID of the packet sent.  Wraps
      at 65535.
   o  Ack ID (uint16): The Sequence ID of the last packet successfully
      received.
   o  Flags (uint8): Bitmask for packet attributes (see Section 4.3).
   o  Reserved (3 bytes): Padding for 16-byte alignment.  MUST be 0.

4.2.  User ID Conventions

   o  Server Authority: 0xFFFFFFFF (-1).  Only the Server uses this.
   o  Unassigned Client: 0x00000000.  Used during handshake.
   o  Assigned Client: 0x00000001 to 0xFFFFFFFE.

4.3.  Reliability Mechanism (Flags)

   The Flags field is used to manage the reliability layer (RUDP).

   Flag Bitmask Values:

   o  0x01 - RELIABLE: The sender requests an acknowledgement for this
      packet.  The receiver MUST acknowledge this packet (either via a
      dedicated ACK or piggybacking).
   o  0x02 - IS_ACK: The Ack ID field in this header is valid and
      acknowledges a previously received packet.

   Behavior:

   1.  Sequence ID: MUST be incremented by 1 for every new packet sent.
   2.  Ack ID: MUST always contain the Sequence ID of the last valid
       packet received from the remote peer.
   3.  Retransmission: If a packet marked RELIABLE is not acknowledged
       within a specific timeout (e.g., 200ms), the sender MUST
       retransmit it.

5.  Protocol Operations (OpCodes)

5.1.  Session Management

5.1.1.  0x01 - C_CONNECT

   o  Sender: Client
   o  Reliability: RELIABLE (Flag 0x01)
   o  Description: Request to establish a connection.
   o  Payload: Empty.

5.1.2.  0x02 - S_ACCEPT

   o  Sender: Server
   o  Reliability: RELIABLE (Flag 0x01)
   o  Description: Connection accepted.  Assigns the User ID to the
      client.
   o  Payload: New User ID (uint32)

5.1.3.  0x03 - DISCONNECT

   o  Sender: Client OR Server
   o  Reliability: RELIABLE (Flag 0x01)
   o  Description: Graceful termination of the session.
   o  Payload: Empty.

5.1.4.  0x04 - C_GET_USERS

   o  Sender: Client
   o  Reliability: RELIABLE
   o  Description: Request a list of currently connected players
      (Lobby).
   o  Payload: Empty.

5.1.5.  0x05 - R_GET_USERS

   o  Sender: Server
   o  Reliability: RELIABLE
   o  Description: Server responds to C_GET_USERS.
   o  Payload:
      *  Count (uint8): Number of users.
      *  UserIDs (uint32[]): Array of User IDs.

5.1.6.  0x06 - S_UPDATE_STATE

   o  Sender: Server
   o  Reliability: RELIABLE
   o  Description: Notifies clients of a global game state change.
   o  Payload: StateID (uint8): 0=Lobby, 1=Running, 2=Paused,
      3=GameOver.

5.1.7.  0x07 - S_GAME_OVER

   o  Sender: Server
   o  Reliability: RELIABLE (Flag 0x01)
   o  Description: Notifies clients that the game has ended with the
      final score.  This is sent when the game reaches a terminal
      state.
   o  Payload: Final Score (uint32): The final accumulated score.

5.2.  Gameplay & Entity Management

5.2.1.  0x10 - S_ENTITY_SPAWN

   o  Sender: Server
   o  Reliability: RELIABLE (Critical: Prevents invisible enemies)
   o  Description: Instructs clients to instantiate a new game object.
   o  Payload:
      *  Entity ID (uint32)
      *  Type (uint8): 0=Player, 1=Bydos, 2=Missile, 3=Pickup,
         4=Obstacle.
      *  PosX (float)
      *  PosY (float)

5.2.2.  0x11 - S_ENTITY_MOVE

   o  Sender: Server
   o  Reliability: UNRELIABLE (Flag 0x00)
   o  Description: Regular state update.  If lost, the next update
      fixes it.
   o  Payload:
      *  Entity ID (uint32)
      *  PosX (float)
      *  PosY (float)
      *  VelX (float)
      *  VelY (float)

5.2.3.  0x12 - S_ENTITY_DESTROY

   o  Sender: Server
   o  Reliability: RELIABLE
   o  Description: Instructs clients to remove an entity.
   o  Payload: Entity ID (uint32)

5.2.4.  0x13 - S_ENTITY_HEALTH

   o  Sender: Server
   o  Reliability: RELIABLE
   o  Description: Synchronizes entity health state with clients.  Sent
      when an entity takes damage or is healed.  Critical for
      displaying health bars and handling death events.
   o  Payload:
      *  Entity ID (uint32) - The network ID of the entity
      *  Current Health (int32) - The entity's remaining health points
      *  Max Health (int32) - The entity's maximum health capacity

5.2.5.  0x14 - S_POWERUP_EVENT

   o  Sender: Server
   o  Reliability: RELIABLE (Flag 0x01)
   o  Description: Notifies all clients that a player has collected a
      power-up.  This allows synchronization of power-up effects across
      all game clients.
   o  Payload:
      *  Player ID (uint32) - The User ID of the player who collected
         the power-up
      *  Power-Up Type (uint8) - The type of power-up collected
         (implementation-specific enumeration)
      *  Duration (float) - Duration in seconds for temporary power-ups
         (0.0 for permanent)

5.3.  Input & Reconciliation

5.3.1.  0x20 - C_INPUT

   o  Sender: Client
   o  Reliability: UNRELIABLE (Sent frequently)
   o  Description: The client sends its current input state.
   o  Payload: Input Mask (uint8):
      *  0x01=UP
      *  0x02=DOWN
      *  0x04=LEFT
      *  0x08=RIGHT
      *  0x10=SHOOT

5.3.2.  0x21 - S_UPDATE_POS (Reconciliation)

   o  Sender: Server
   o  Reliability: UNRELIABLE
   o  Description: Correction of client position.
   o  Payload:
      *  Authoritative X (float)
      *  Authoritative Y (float)

5.4.  System & Diagnostics

5.4.1.  0xF0 - PING

   o  Sender: Client or Server
   o  Reliability: UNRELIABLE
   o  Description: Latency measurement request.  The receiver should
      respond with a PONG.
   o  Payload: Empty (timestamp can be tracked via seqId).

5.4.2.  0xF1 - PONG

   o  Sender: Client or Server
   o  Reliability: UNRELIABLE
   o  Description: Latency measurement response.  Echoes the seqId from
      PING via ackId.
   o  Payload: Empty.

6.  Security Considerations

   1.  Header Validation: Any packet where Header[0] != 0xA1 MUST be
       silently dropped.
   2.  Sequence Validation: Packets with a Sequence ID significantly
       older than the last received ID SHOULD be discarded to prevent
       replay attacks and processing old state.
   3.  Spoofing Protection: The Server MUST verify User ID against
       IP/Port.
   4.  Authority Check: Clients MUST ignore packets claiming to be
       0xFFFFFFFF (Server) if they do not originate from the known
       Server IP endpoint.

7.  Payload Size Reference

   +------------------+-------------------+---------------------------+
   | OpCode           | Payload Size      | Notes                     |
   |                  | (bytes)           |                           |
   +------------------+-------------------+---------------------------+
   | C_CONNECT        | 0                 | Empty                     |
   | S_ACCEPT         | 4                 | uint32                    |
   | DISCONNECT       | 0                 | Empty                     |
   | C_GET_USERS      | 0                 | Empty                     |
   | R_GET_USERS      | Variable          | 1 + (count * 4)           |
   | S_UPDATE_STATE   | 1                 | uint8                     |
   | S_GAME_OVER      | 4                 | uint32                    |
   | S_ENTITY_SPAWN   | 13                | uint32+uint8+float+float  |
   | S_ENTITY_MOVE    | 20                | uint32 + 4*float          |
   | S_ENTITY_DESTROY | 4                 | uint32                    |
   | S_ENTITY_HEALTH  | 12                | uint32+int32+int32        |
   | S_POWERUP_EVENT  | 9                 | uint32+uint8+float        |
   | C_INPUT          | 1                 | uint8                     |
   | S_UPDATE_POS     | 8                 | 2*float                   |
   | PING             | 0                 | Empty                     |
   | PONG             | 0                 | Empty                     |
   +------------------+-------------------+---------------------------+

8.  Changes from Previous Versions

8.1.  Version 1.3.0 (2025-12-15)

   o  Added OpCode 0x07 - S_GAME_OVER: Server notification for game
      termination with final score
   o  Added OpCode 0x14 - S_POWERUP_EVENT: Synchronization of power-up
      collection events
   o  Added OpCode 0xF0 - PING: Latency measurement request (previously
      reserved)
   o  Added OpCode 0xF1 - PONG: Latency measurement response
      (previously reserved)
   o  Updated Section 5.2: Extended entity type enumeration to include
      Pickup (3) and Obstacle (4)
   o  Added Section 7: Payload size reference table for quick lookup
   o  Updated Section 2.1: Added int32 data type specification for
      signed integers

8.2.  Version 1.2.0 (2025-12-10)

   o  Added OpCode 0x13 - S_ENTITY_HEALTH: Health synchronization for
      entities

8.3.  Version 1.0.0 (Initial)

   o  Initial protocol specification

9.  Future Extensions

   o  Packet Fragmentation: Not currently supported.  Payloads
      exceeding MTU must be handled at the application logic level or
      split into multiple entities.
   o  Encryption Layer: Consider TLS-over-UDP (DTLS) for secure
      communications.
   o  Voice Chat Integration: Reserved OpCode range 0x30-0x3F for
      future audio streaming.
   o  Replay System: Reserved OpCode range 0x40-0x4F for game state
      recording/playback.

Authors' Addresses

   R-Type Project Team
   EPITECH

   Email: rtype-project@epitech.eu
